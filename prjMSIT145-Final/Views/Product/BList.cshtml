@{
	ViewData["Title"] = "BList";
}
@section Styles{
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.css">
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.js"></script>
	<script src="../js/ProductList.js"> </script>
	<link rel="stylesheet" href="../css/ProductList.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
}
<div>
	<div class="top">
		<div>
			<h2 id="h2">餐點</h2>
		</div>
		<div class="topbutton">
			<a href="@Url.Content("~/Product/BCreate")"><input class="insertbutton" type="button" value="+新增餐點" id="btnCreateProduct" /></a>
			<input class="insertbutton" type="button" value="+新增類別" id="btnCreateType" />
		</div>
	</div>
	<input class="inserselecttext" type="text" placeholder="搜尋...." id="txtKeyword"/>
	<!-- <select ><option></option></select>
	 -->
	<table id="table" class="table table-hover stripe">
		<thead>
		 <th>相片</th>
		 <th>名稱</th>
		 <th>價格</th>
		 <th>類別</th>
		 <th>備註</th>
		 <th>刪除編輯</th>
		</thead>
		<tbody id="tbody">
			@*<tr>
				<td><input type="image" src="../images/uparrow.png"></td>
				<td>花枝排</td>
				<td>70.00</td>
				<td>小菜類</td>
				<td>-</td>
				<td>
					<button class="buteditgar"><img src="../images/garbage.png"></button>
					<button class="buteditgar"><img src="../images/edit.png"></button>
				</td>
			</tr>
			*@
		</tbody>
	</table>
</div>
@section Scripts{
	<script>
		const txt = document.querySelector("#txtKeyword");
		const tbody = document.querySelector("#tbody");
		const btnCreateProduct = document.querySelector("#btnCreateProduct"); //新增產品
		const btnCreateType = document.querySelector("#btnCreateType"); //新增類別
		const btnEdit = document.getElementsByName("btnEdit") //編輯按鈕
		const btnDelete = document.getElementsByName("btnDelete") //編輯按鈕

		//關鍵字查詢(類別與商品)
		txt.addEventListener("keyup", () => search());

		search();
		async function search() {
			let response = await fetch(`@Url.Content("~/Product/BSearch?keyword=${txt.value}")`);
			const datas = await response.json();
			let result = document.createDocumentFragment();
			result = "";
			datas.forEach(function (item,index) {
				//console.log(item.categoryName);
				if(item.photo == null)
				item.photo = "uparrow.png";
				result += `<tr>
								<input type="hidden" name="${item.fid}" value="${item.fid}" id="${item.fid}"/>
								<input type="hidden" name="${item.bFid}" value="${item.bFid}"/>
						<input type="hidden" name="${item.categoryFid}" value="${item.categoryFid}"/>
						
						<td><input style='width:30px; height:20px;' type="image" src="../images/${item.photo}"></td>
								<td>${item.productName}</td>
						<td>${item.unitPrice}</td>
						<td>${item.categoryName}</td>
						<td>${item.memo}</td>
						<td>
							<a href='@Url.Content("~/Product/BEdit/${item.fid}")'><button class="buteditgar" name='btnEdit'><img src="../images/garbage.png">編輯</button></a>
							<button class="buteditgar" name='btnDelete'><img src="../images/edit.png">刪除</button>
						</td>
					</tr>`
			});
			tbody.innerHTML = result;

		//	//編輯
		//	btnEdit.forEach(function (btnClick) {
		//	btnClick.addEventListener("click", function () {
		//	})
		//})

		//刪除
		btnDelete.forEach(function(btnClick){
			btnClick.addEventListener("click",function(){
				console.log(this)
			})
		})
		}
		//新增類別
		btnCreateType.addEventListener("click",function(){
			alert(`<div class="outerlayer ">
				<form>
				<div class="topdiv">
					<img class="back" src="../images/backarrow.png" value="">
					<input  class="inputtext" type="text" placeholder=" 輸入類別名稱....." />
					<input class="butt"type="submit" value="儲存"/>
				</div>
				</form>
				</div>`)
		})
	</script>
}
